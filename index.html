<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일본어 문법 학습 앱</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .card {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .content-hidden {
            visibility: hidden;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: visibility 0s 0.3s, opacity 0.3s ease-out, height 0.3s ease-out;
        }
        .content-visible {
            visibility: visible;
            opacity: 1;
            height: auto;
            transition: opacity 0.3s ease-in, height 0.3s ease-in;
        }
        .example-item {
            border-left: 3px solid #4F46E5; /* Tailwind indigo-600 */
            padding-left: 0.75rem; /* pl-3 */
            margin-bottom: 0.5rem; /* mb-2 */
            cursor: pointer; /* 예문 클릭 가능하도록 커서 변경 */
        }
        .example-item:hover {
            background-color: #f0f0f0; /* 클릭 가능한 예문에 호버 효과 */
        }
        .modal {
            display: none; 
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5); 
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto; 
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 600px; 
            border-radius: 0.5rem; 
            max-height: 80vh; 
            overflow-y: auto; 
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .memorized-item {
            background-color: #E0F2FE; 
        }
        .not-memorized-item {
            background-color: #FEF3C7; 
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen flex flex-col items-center justify-center p-2 sm:p-4 selection:bg-purple-300 selection:text-purple-900">

    <div class="bg-white shadow-2xl rounded-xl p-4 sm:p-6 w-full max-w-2xl card transform transition-all duration-500 ease-in-out">
        <div>
            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold text-center text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 mb-4 sm:mb-6">일본어 문법 학습</h1>
            
            <div class="flex justify-between items-center mb-2">
                <div id="grammarId" class="text-xs sm:text-sm text-gray-500"></div>
                <button id="toggleMemorizedButton" class="text-xs sm:text-sm py-1 px-2 rounded-md focus:outline-none">
                </button>
            </div>

            <div id="grammarPattern" class="text-lg sm:text-xl md:text-2xl font-semibold text-indigo-700 mb-3 sm:mb-4 p-3 sm:p-4 bg-indigo-50 rounded-lg text-center">
            </div>

            <div id="detailsContainer">
                <div id="meaningContainer" class="content-hidden">
                    <h2 class="text-base sm:text-lg md:text-xl font-semibold text-purple-700 mt-3 sm:mt-4 mb-1 sm:mb-2">의미:</h2>
                    <p id="grammarMeaning" class="text-gray-700 bg-purple-50 p-2 sm:p-3 rounded-md text-sm sm:text-base md:text-lg">
                    </p>
                </div>

                <div id="examplesContainer" class="content-hidden mt-3 sm:mt-4">
                    <h2 class="text-base sm:text-lg md:text-xl font-semibold text-purple-700 mb-1 sm:mb-2">예문:</h2>
                    <div id="grammarExamples" class="space-y-2 sm:space-y-3">
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-6 sm:mt-8">
            <div class="flex items-center justify-between mb-3">
                <button id="showAllButton" class="w-2/5 bg-green-500 hover:bg-green-600 text-white font-semibold py-2.5 sm:py-3 px-3 sm:px-4 rounded-lg shadow-md text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-green-400">
                    <i class="fas fa-list-ul mr-1"></i> 전체 보기
                </button>
                <button id="playPauseButton" class="w-2/5 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2.5 sm:py-3 px-3 sm:px-4 rounded-lg shadow-md text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <i class="fas fa-play mr-1"></i> 자동 재생
                </button>
            </div>
            <div class="flex flex-col sm:flex-row justify-between items-center space-y-3 sm:space-y-0 sm:space-x-4">
                <button id="revealButton" class="w-full sm:w-auto bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg shadow-md text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-purple-400">
                    뜻/예문 보기
                </button>
                <div class="w-full sm:w-auto flex space-x-3 sm:space-x-4">
                    <button id="prevButton" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg shadow-md text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-indigo-400">
                        이전
                    </button>
                    <button id="nextButton" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2.5 sm:py-3 px-5 sm:px-6 rounded-lg shadow-md text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-indigo-400">
                        다음
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="allGrammarModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeModalButton">&times;</span>
            <h2 class="text-xl sm:text-2xl font-bold text-center text-indigo-600 mb-4">전체 문법 목록</h2>
            <div id="allGrammarList" class="space-y-2">
            </div>
        </div>
    </div>

    <script>
        const grammarData = [
            // ... (기존 grammarData는 생략) ...
            // 전체 데이터 (001 ~ 115) - 이전 코드와 동일하게 유지 (양해를 위해 생략)
            { id: 1, pattern: "~か", meaning: "~인가, ~인지, ~이나 / ~할지 ~하지 않을지", examples: [{ japanese: "図書館は何時まで開いているか教えてください。", korean: "도서관은 몇 시까지 열려 있는지 가르쳐 주세요." },{ japanese: "自転車で行くかバスで行くかまだ決めていない。", korean: "자전거로 갈지 버스로 갈지 아직 정하지 않았다." },{ japanese: "パーティーは何時に始まるか知っていますか。", korean: "파티는 몇 시에 시작되는지 알고 있습니까?" }]},
            { id: 2, pattern: "~が", meaning: "~이/가 (주어), ~을/를 (희망, 능력, 기호)", examples: [{ japanese: "りんごのケーキがおいしいそうです。", korean: "사과 케이크가 맛있다고 합니다." },{ japanese: "私はピアノをひくのが好きです。", korean: "저는 피아노 치는 것을 좋아합니다." },{ japanese: "どれがあなたの傘ですか。", korean: "어느 것이 당신의 우산입니까?" }]},
            { id: 3, pattern: "~から", meaning: "~하기 때문에 (이유), ~으로 (재료), ~로부터, ~에게서 (동작주)", examples: [{ japanese: "今日は疲れたから、早く寝ます。", korean: "오늘은 피곤하기 때문에 일찍 자겠습니다." },{ japanese: "このお酒は米から作られます。", korean: "이 술은 쌀로 만들어집니다." },{ japanese: "友達から誕生日プレゼントが届いた。", korean: "친구에게서 생일 선물이 도착했다." }]},
            { id: 4, pattern: "~ぐらい・くらい", meaning: "~정도, ~쯤 (대략의 수량)", examples: [{ japanese: "毎日2時間ぐらい日本語を勉強します。", korean: "매일 2시간 정도 일본어를 공부합니다." },{ japanese: "ここから駅まで5分ぐらいです。", korean: "여기서 역까지 5분 정도입니다." },{ japanese: "日本語の本を50冊ぐらい持っています。", korean: "일본어 책을 50권 정도 갖고 있습니다." }]},
            { id: 5, pattern: "~けれど(も)・けど", meaning: "~하지만, ~그렇지만, ~인데도 / (서두) ~말인데, ~인데요", examples: [{ japanese: "行きたいけれど、時間がない。", korean: "가고 싶지만, 시간이 없다." },{ japanese: "このレストランは美味しいけど、ちょっと高いね。", korean: "이 레스토랑은 맛있지만, 좀 비싸네." },{ japanese: "明日のことだけど、少し手伝ってくれない？", korean: "내일 일인데, 좀 도와주지 않을래?" }]},
            { id: 6, pattern: "~しか", meaning: "~밖에 (+부정형)", examples: [{ japanese: "千円しか持っていません。", korean: "천 엔밖에 가지고 있지 않습니다." },{ japanese: "彼女には一度しか会ったことがない。", korean: "그녀는 한 번밖에 만난 적이 없다." },{ japanese: "こんなことは友達にしか話せない。", korean: "이런 이야기는 친구에게밖에 할 수 없다." }]},
            { id: 7, pattern: "~だけ", meaning: "~만, ~뿐", examples: [{ japanese: "静かなのは食事のときだけだ。", korean: "조용한 것은 식사 때뿐이다." },{ japanese: "やさしい言葉だけ覚えました。", korean: "쉬운 단어만 외웠습니다." },{ japanese: "必要なものだけ買いました。", korean: "필요한 것만 샀습니다." }]},
            { id: 8, pattern: "~で", meaning: "~으로(수단/방법/재료), ~에서(장소), ~때문에(이유/원인), ~으로(범위/한계)", examples: [{ japanese: "バスで学校へ行きます。", korean: "버스로 학교에 갑니다." },{ japanese: "風邪で仕事を休みました。", korean: "감기 때문에 일을 쉬었습니다." },{ japanese: "このおもちゃは木でできています。", korean: "이 장난감은 나무로 만들어져 있습니다." },{ japanese: "3分でできます。", korean: "3분이면 할 수 있습니다." }]},
            { id: 9, pattern: "~でも", meaning: "~(이)라도 (하나를 예로 들거나 최소한의 것을 나타냄), ~든지 (전면적 긍정)", examples: [{ japanese: "お茶でも飲みませんか。", korean: "차라도 마시지 않겠습니까?" },{ japanese: "子どもでもそんなことは分かります。", korean: "어린아이라도 그런 것은 압니다." },{ japanese: "どこへでも行きます。", korean: "어디든지 가겠습니다." }]},
            { id: 10, pattern: "~と / ~って / ~という", meaning: "~와/과, ~라고 (인용), ~라는 (명칭)", examples: [{ japanese: "友達と映画を見に行きました。", korean: "친구와 영화를 보러 갔습니다." },{ japanese: "彼は「ありがとう」と言いました。", korean: "그는 '고맙습니다'라고 말했습니다." },{ japanese: "「さくら」という名前の犬を飼っています。", korean: "'사쿠라'라는 이름의 개를 키우고 있습니다." },{ japanese: "彼はすぐ来るって言ってたよ。", korean: "그는 금방 온다고 말했어." }]},
            { id: 11, pattern: "~とか", meaning: "~라든가, ~같은 것 (여러 개를 열거하며 예시)", examples: [{ japanese: "週末は映画を見るとか、本を読むとかしています。", korean: "주말에는 영화를 본다든가, 책을 읽는다든가 하고 있습니다." },{ japanese: "ひきだしにはスプーンとかフォークとかが入っています。", korean: "서랍에는 스푼이라든가 포크라든가 들어있습니다." },{ japanese: "病気のお見舞いには果物とかお花とかがいいでしょう。", korean: "병문안에는 과일이라든가 꽃이라든가 좋을 거예요." }]},
            { id: 12, pattern: "~な (동사 사전형 + な)", meaning: "~하지 마라 (금지)", examples: [{ japanese: "危ないから、そこに入るな。", korean: "위험하니까, 거기에 들어가지 마라." },{ japanese: "授業中に騒ぐな。", korean: "수업 중에 떠들지 마라." },{ japanese: "そんな汚い手で触るな。", korean: "그런 더러운 손으로 만지지 마라." }]},
            { id: 13, pattern: "~に", meaning: "~에(시간/장소/방향/목적), ~에게(대상), ~으로(변화의 결과)", examples: [{ japanese: "朝7時に起きます。", korean: "아침 7시에 일어납니다." },{ japanese: "先生に質問しました。", korean: "선생님께 질문했습니다." },{ japanese: "氷が水になりました。", korean: "얼음이 물이 되었습니다." },{ japanese: "その仕事、私にさせてください。", korean: "그 일, 저에게 시켜주세요." }]},
            { id: 14, pattern: "~の (문미)", meaning: "~거야?, ~거니? (질문, 설명 요구, 가벼운 단정)", examples: [{ japanese: "どうして昨日休んだの？", korean: "어째서 어제 쉰 거야?" },{ japanese: "どこへ行くの？", korean: "어디 가는 거야?" },{ japanese: "山田さんが歌っているのが聞こえます。", korean: "야마다 씨가 노래 부르는 것이 들립니다." }]},
            { id: 15, pattern: "~ので", meaning: "~이므로, ~하기 때문에, ~라서 (객관적인 이유, 원인)", examples: [{ japanese: "その公園は静かで綺麗なので、よく散歩に行きます。", korean: "그 공원은 조용하고 깨끗하기 때문에 자주 산책하러 갑니다." },{ japanese: "コーヒーがおいしかったので、もう一杯頼みました。", korean: "커피가 맛있었기 때문에 한 잔 더 주문했습니다." },{ japanese: "雨が降っているので、試合は中止です。", korean: "비가 오고 있어서 시합은 중지입니다." }]},
            { id: 16, pattern: "~のに", meaning: "~인데도, ~에도 불구하고 (역접) / ~하는 데에 (목적, 용도, 평가)", examples: [{ japanese: "田中さんは病気なのに、会社に来ました。", korean: "다나카 씨는 아픈데도 회사에 왔습니다." },{ japanese: "この橋を造るのに4年かかりました。", korean: "이 다리를 만드는 데 4년 걸렸습니다." },{ japanese: "頑張って宿題をやったのに、褒められなかった。", korean: "열심히 숙제를 했는데도 칭찬받지 못했다." }]},
            { id: 17, pattern: "~は", meaning: "~은/는 (주제 제시, 강조, 대조)", examples: [{ japanese: "私の財布は机の上にあります。", korean: "내 지갑은 책상 위에 있습니다." },{ japanese: "私はお酒は飲みません。", korean: "나는 술은 안 마십니다. (다른 것은 마실 수 있다는 뉘앙스)" },{ japanese: "今日は天気がいいですね。", korean: "오늘은 날씨가 좋네요." }]},
            { id: 18, pattern: "~ばかり", meaning: "~만, ~뿐 (그것에 한정됨, 그것이 계속됨)", examples: [{ japanese: "この本には知らないことばかり書いてある。", korean: "이 책에는 모르는 것만 쓰여 있다." },{ japanese: "彼は大学に入ってから遊んでばかりいます。", korean: "그는 대학에 들어간 후 놀고만 있습니다." },{ japanese: "うちの子は漫画ばかり読んでいます。", korean: "우리 아이는 만화만 읽고 있습니다." }]},
            { id: 19, pattern: "~までに", meaning: "~까지 (동작이나 행위가 완료되는 기한)", examples: [{ japanese: "明日までにこのレポートを提出してください。", korean: "내일까지 이 리포트를 제출해주세요." },{ japanese: "7時までに駅に着かなければなりません。", korean: "7시까지 역에 도착해야 합니다." },{ japanese: "会議は5時までに終わります。", korean: "회의는 5시까지 끝납니다." }]},
            { id: 20, pattern: "~も", meaning: "~도 (첨가, 병렬), ~(이)나 (수량이 많거나 정도가 심함을 강조)", examples: [{ japanese: "私も行きます。", korean: "나도 갑니다." },{ japanese: "昨日は手紙を20枚も書きました。", korean: "어젯밤에는 편지를 스무 장이나 썼습니다." },{ japanese: "駅から学校まで歩いて20分もかかります。", korean: "역에서 학교까지 걸어서 20분이나 걸립니다." }]},
            { id: 21, pattern: "~を", meaning: "~을/를 (목적어), ~을/를 (통과하는 장소, 출발점)", examples: [{ japanese: "公園を散歩します。", korean: "공원을 산책합니다." },{ japanese: "毎朝ジュースを飲みます。", korean: "매일 아침 주스를 마십니다." },{ japanese: "次の角を右に曲がってください。", korean: "다음 모퉁이를 오른쪽으로 돌아주세요." }]},
            { id: 22, pattern: "~あいだ (間)", meaning: "~동안, ~사이에", examples: [{ japanese: "夏休みの間、毎日図書館へ行きました。", korean: "여름방학 동안 매일 도서관에 갔습니다." },{ japanese: "私が出張に行っている間、家のことをお願いします。", korean: "제가 출장 가 있는 동안 집안일을 부탁합니다." },{ japanese: "授業の間は静かにしてください。", korean: "수업 동안에는 조용히 해주세요." }]},
            { id: 23, pattern: "いくら~ても", meaning: "아무리 ~해도", examples: [{ japanese: "いくら電話をかけても出ません。", korean: "아무리 전화를 걸어도 받지 않습니다." },{ japanese: "いくらたくさん食べても、すぐお腹が空きます。", korean: "아무리 많이 먹어도 금방 배가 고파집니다." },{ japanese: "あの人の話はいくら聞いても分かりません。", korean: "저 사람 이야기는 아무리 들어도 모르겠습니다." }]},
            { id: 24, pattern: "~(よ)う / ~(よ)うか", meaning: "~하자, ~해야지 (의지, 권유) / ~할까? (제안, 질문)", examples: [{ japanese: "一緒に映画を見よう。", korean: "같이 영화 보자." },{ japanese: "私が手伝おうか。", korean: "내가 도와줄까?" },{ japanese: "もう悩むのはやめよう。", korean: "이제 고민하는 것은 그만두자." }]},
            { id: 25, pattern: "~(よ)うと思う", meaning: "~하려고 생각하다 (의지, 계획)", examples: [{ japanese: "週末は家でゆっくり休もうと思います。", korean: "주말에는 집에서 푹 쉬려고 생각합니다." },{ japanese: "来年日本へ留学しようと思っています。", korean: "내년에 일본으로 유학 가려고 생각하고 있습니다." },{ japanese: "毎日少しずつ勉強しようと思っています。", korean: "매일 조금씩 공부하려고 생각하고 있습니다." }]},
            { id: 26, pattern: "~(よ)うとする", meaning: "~하려고 하다 (시도, 막 ~하려는 순간)", examples: [{ japanese: "家を出ようとしたとき、電話がかかってきました。", korean: "집을 막 나으려고 했을 때 전화가 걸려 왔습니다." },{ japanese: "猫が逃げようとするのを捕まえた。", korean: "고양이가 도망치려고 하는 것을 잡았다." },{ japanese: "冷静に話そうとしても、つい感情的になってしまう。", korean: "냉정하게 이야기하려고 해도 그만 감정적이 되어 버린다." }]},
            { id: 27, pattern: "お~ください", meaning: "~해 주십시오 (정중한 의뢰, 동사 ます형 어간 + ください)", examples: [{ japanese: "こちらでお待ちください。", korean: "여기서 기다려 주십시오." },{ japanese: "この紙にご住所とお名前をお書きください。", korean: "이 종이에 주소와 성함을 적어 주십시오." },{ japanese: "どうぞお入りください。", korean: "부디 들어오십시오." }]},
            { id: 28, pattern: "お~する", meaning: "(자신을 낮추어) ~하다, ~해 드리다 (겸양 표현, 동사 ます형 어간 + する)", examples: [{ japanese: "荷物をお持ちします。", korean: "짐을 들어 드리겠습니다." },{ japanese: "後ほどこちらからお電話します。", korean: "나중에 저희 쪽에서 전화 드리겠습니다." },{ japanese: "先生にご案内します。", korean: "선생님께 안내해 드리겠습니다." }]},
            { id: 29, pattern: "お~になる", meaning: "~하시다 (존경 표현, 동사 ます형 어간 + になる)", examples: [{ japanese: "先生は何時ごろお帰りになりますか。", korean: "선생님은 몇 시쯤 돌아오십니까?" },{ japanese: "社長は今新聞をお読みになっています。", korean: "사장님은 지금 신문을 읽고 계십니다." },{ japanese: "どうぞお座りになってください。", korean: "부디 앉으십시오." }]},
            { id: 30, pattern: "~おわる (終わる)", meaning: "다 ~하다 (동작의 완료, 동사 ます형 어간 + 終わる)", examples: [{ japanese: "本を読み終わったら、貸してください。", korean: "책을 다 읽으면 빌려주세요." },{ japanese: "ご飯を食べ終わると、眠くなりました。", korean: "밥을 다 먹으니 졸렸습니다." },{ japanese: "宿題を書き終わったので、遊びに行きます。", korean: "숙제를 다 써서 놀러 갑니다." }]},
            { id: 31, pattern: "~がする", meaning: "~이 나다, ~이 들다 (냄새, 소리, 맛, 느낌 등)", examples: [{ japanese: "隣の部屋から変な音がします。", korean: "옆방에서 이상한 소리가 납니다." },{ japanese: "このスープはいい匂いがしますね。", korean: "이 수프는 좋은 냄새가 나네요." },{ japanese: "なんだか寒気がします。", korean: "왠지 한기가 듭니다." }]},
            { id: 32, pattern: "~方 (かた)", meaning: "~하는 방법 (동사 ます형 어간 + 方)", examples: [{ japanese: "この漢字の読み方を教えてください。", korean: "이 한자 읽는 법을 가르쳐 주세요." },{ japanese: "パソコンの使い方がよく分かりません。", korean: "컴퓨터 사용법을 잘 모르겠습니다." },{ japanese: "料理の作り方を母に習いました。", korean: "요리 만드는 법을 어머니께 배웠습니다." }]},
            { id: 33, pattern: "~がる / ~がっている", meaning: "~싶어하다, ~해 하다 (제3자의 감정이나 욕구 표현)", examples: [{ japanese: "子供たちはプレゼントを欲しがっています。", korean: "아이들은 선물을 갖고 싶어하고 있습니다." },{ japanese: "彼は犬を怖がっているようです。", korean: "그는 개를 무서워하는 것 같습니다." },{ japanese: "彼女は恥ずかしがって何も言えなかった。", korean: "그녀는 부끄러워해서 아무 말도 못 했다." }]},
            { id: 34, pattern: "~かどうか", meaning: "~인지 어떤지, ~인지 아닌지 (불확실한 사항)", examples: [{ japanese: "明日晴れるかどうか分かりません。", korean: "내일 날씨가 갤지 어떨지 모르겠습니다." },{ japanese: "彼が来るかどうか確認してください。", korean: "그가 올지 어떨지 확인해주세요." },{ japanese: "美味しいかどうか食べてみないと分からない。", korean: "맛있는지 어떤지는 먹어보지 않으면 모른다." }]},
            { id: 35, pattern: "~かもしれない", meaning: "~일지도 모른다 (추측, 가능성)", examples: [{ japanese: "明日は雨が降るかもしれません。", korean: "내일은 비가 올지도 모릅니다." },{ japanese: "彼はもう帰ったかもしれない。", korean: "그는 이미 돌아갔을지도 모른다." },{ japanese: "この問題は難しいかもしれません。", korean: "이 문제는 어려울지도 모릅니다." }]},
            { id: 36, pattern: "~くする / ~にする", meaning: "~하게 하다 (형용사/형용동사를 부사적으로 사용)", examples: [{ japanese: "部屋を明るくしました。", korean: "방을 밝게 했습니다." },{ japanese: "音を小さくしてください。", korean: "소리를 작게 해주세요." },{ japanese: "公園をきれいにしました。", korean: "공원을 깨끗하게 했습니다." }]},
            { id: 37, pattern: "~くなる / ~になる", meaning: "~해지다, ~게 되다 (상태의 변화)", examples: [{ japanese: "だんだん寒くなってきました。", korean: "점점 추워졌습니다." },{ japanese: "日本語が上手になりましたね。", korean: "일본어가 능숙해졌네요." },{ japanese: "病気が治って元気になりました。", korean: "병이 나아서 건강해졌습니다." }]},
            { id: 38, pattern: "~こと", meaning: "~것, ~일 (행위나 사실을 명사화)", examples: [{ japanese: "私がここにいることを誰から聞きましたか。", korean: "내가 여기에 있는 것을 누구에게서 들었습니까?" },{ japanese: "毎日運動することは健康にいいです。", korean: "매일 운동하는 것은 건강에 좋습니다." },{ japanese: "昨日習ったことを復習しました。", korean: "어제 배운 것을 복습했습니다." }]},
            { id: 39, pattern: "~ことがある", meaning: "~한 적이 있다 (경험) / ~할 때가 있다 (경우)", examples: [{ japanese: "富士山に登ったことがあります。", korean: "후지산에 오른 적이 있습니다." },{ japanese: "時々、朝ごはんを食べないことがあります。", korean: "가끔 아침밥을 먹지 않을 때가 있습니다." },{ japanese: "名前が思い出せないことがときどきある。", korean: "이름이 생각나지 않을 때가 가끔 있다." }]},
            { id: 40, pattern: "~ことができる", meaning: "~할 수 있다 (가능)", examples: [{ japanese: "私は日本語で手紙を書くことができます。", korean: "저는 일본어로 편지를 쓸 수 있습니다." },{ japanese: "この図書館では古い新聞を読むことができます。", korean: "이 도서관에서는 오래된 신문을 읽을 수 있습니다." },{ japanese: "ペットと一緒に入ることができる店は少ないです。", korean: "애완동물과 함께 들어갈 수 있는 가게는 적습니다." }]},
            { id: 41, pattern: "~ことにする", meaning: "~하기로 하다 (자신의 의지로 결정)", examples: [{ japanese: "明日から毎日ジョギングをすることにしました。", korean: "내일부터 매일 조깅을 하기로 했습니다." },{ japanese: "タバコをやめることにしました。", korean: "담배를 끊기로 했습니다." },{ japanese: "来月、国へ帰ることにしました。", korean: "다음 달에 고향에 돌아가기로 했습니다." }]},
            { id: 42, pattern: "~ことになる / ~ことになっている", meaning: "~하게 되다 (결정, 규칙) / ~하기로 되어 있다 (예정, 규칙)", examples: [{ japanese: "来年、東京へ転勤することになりました。", korean: "내년에 도쿄로 전근가게 되었습니다." },{ japanese: "この学校では毎月試験を行うことになっています。", korean: "이 학교에서는 매달 시험을 치르기로 되어 있습니다." },{ japanese: "会議は午後2時から始まることになった。", korean: "회의는 오후 2시부터 시작하게 되었다." }]},
            { id: 43, pattern: "~さ", meaning: "~함 (형용사의 명사화, 정도를 나타냄)", examples: [{ japanese: "この池の深さは2メートルぐらいです。", korean: "이 연못의 깊이는 2미터 정도입니다." },{ japanese: "荷物の重さを測ってください。", korean: "짐의 무게를 재 주세요." },{ japanese: "この町の賑やかさが好きです。", korean: "이 마을의 번화함이 좋습니다." }]},
            { id: 44, pattern: "~し", meaning: "~하고, ~인데다(가), ~이니까 (이유나 원인의 열거, 병렬)", examples: [{ japanese: "このレストランは美味しいし、値段も安いです。", korean: "이 레스토랑은 맛있고, 가격도 쌉니다." },{ japanese: "頭も痛いし、熱もあるから、今日は休みます。", korean: "머리도 아프고 열도 있으니까 오늘은 쉬겠습니다." },{ japanese: "バラの花は色もきれいだし、匂いもいいです。", korean: "장미꽃은 색깔도 예쁘고 향기도 좋습니다." }]},
            { id: 45, pattern: "~すぎる", meaning: "너무 ~하다, 지나치게 ~하다 (정도가 과함)", examples: [{ japanese: "このかばんは大きすぎて不便です。", korean: "이 가방은 너무 커서 불편합니다." },{ japanese: "昨日はお酒を飲みすぎました。", korean: "어제는 술을 너무 많이 마셨습니다." },{ japanese: "砂糖を入れすぎると、甘くなりすぎます。", korean: "설탕을 너무 많이 넣으면 너무 달아집니다." }]},
            { id: 46, pattern: "~ずに / ~ないで", meaning: "~하지 않고, ~하지 말고", examples: [{ japanese: "朝ご飯を食べずに学校へ来ました。", korean: "아침밥을 먹지 않고 학교에 왔습니다." },{ japanese: "辞書を見ないで答えてください。", korean: "사전을 보지 말고 대답해주세요." },{ japanese: "傘をささないで雨の中を歩いた。", korean: "우산을 쓰지 않고 빗속을 걸었다." }]},
            { id: 47, pattern: "~(さ)せてください", meaning: "~하게 해주세요 (허락을 구함)", examples: [{ japanese: "今日は早く帰らせてください。", korean: "오늘은 일찍 돌아가게 해주세요." },{ japanese: "少し休ませてください。", korean: "조금 쉬게 해주세요." },{ japanese: "私にその仕事をさせてください。", korean: "저에게 그 일을 시켜주세요." }]},
            { id: 48, pattern: "~(さ)せられる", meaning: "억지로 ~하게 되다, ~하도록 강요받다 (사역 수동)", examples: [{ japanese: "子供のころ、母に嫌いな野菜を食べさせられた。", korean: "어릴 적, 어머니가 싫어하는 야채를 억지로 먹게 했다." },{ japanese: "毎日遅くまで残業させられて、疲れた。", korean: "매일 늦게까지 야근을 강요당해서 지쳤다." },{ japanese: "歌いたくないのに、歌わされた。", korean: "노래하고 싶지 않은데 억지로 노래하게 되었다." }]},
            { id: 49, pattern: "~(さ)せる", meaning: "~하게 하다, ~시키다 (사역)", examples: [{ japanese: "先生は生徒に宿題をたくさんさせた。", korean: "선생님은 학생에게 숙제를 많이 시켰다." },{ japanese: "子供を塾に通わせています。", korean: "아이를 학원에 다니게 하고 있습니다." },{ japanese: "心配しないでください。彼に行かせますから。", korean: "걱정하지 마세요. 그를 가게 할 테니까요." }]},
            { id: 50, pattern: "~そうだ", meaning: "~인 것 같다 (양태) / ~라고 한다 (전문)", examples: [{ japanese: "雨が降りそうです。", korean: "비가 올 것 같습니다. (양태)" },{ japanese: "このケーキは美味しそうですね。", korean: "이 케이크는 맛있어 보이네요. (양태)" },{ japanese: "天気予報によると、明日は晴れるそうです。", korean: "일기예보에 따르면 내일은 맑다고 합니다. (전문)" }]},
            { id: 51, pattern: "~たい / ~たがる", meaning: "~하고 싶다 (자신의 희망) / ~하고 싶어하다 (제3자의 희망)", examples: [{ japanese: "日本へ行きたいです。", korean: "일본에 가고 싶습니다." },{ japanese: "子供は新しいおもちゃをたがっています。", korean: "아이는 새 장난감을 갖고 싶어합니다." },{ japanese: "いつか試合に出てみたいです。", korean: "언젠가 시합에 나가보고 싶습니다." }]},
            { id: 52, pattern: "~たことがある", meaning: "~한 적이 있다 (과거 경험)", examples: [{ japanese: "北海道へ行ったことがありますか。", korean: "홋카이도에 간 적이 있습니까?" },{ japanese: "この映画は前に見たことがあります。", korean: "이 영화는 전에 본 적이 있습니다." },{ japanese: "日本の歌舞伎はまだ見たことがありません。", korean: "일본 가부키는 아직 본 적이 없습니다." }]},
            { id: 53, pattern: "~だす (出す)", meaning: "~하기 시작하다 (갑작스러운 시작, 동사 ます형 어간 + 出す)", examples: [{ japanese: "急に雨が降りだした。", korean: "갑자기 비가 내리기 시작했다." },{ japanese: "赤ちゃんが泣きだしたので、びっくりした。", korean: "아기가 울기 시작해서 깜짝 놀랐다." },{ japanese: "止まっていたバスが動きだした。", korean: "멈춰 있던 버스가 움직이기 시작했다." }]},
            { id: 54, pattern: "~たところだ", meaning: "막 ~한 참이다 (동작의 직후 완료)", examples: [{ japanese: "今、ご飯を食べたところです。", korean: "지금 막 밥을 먹은 참입니다." },{ japanese: "会議はちょうど終わったところです。", korean: "회의는 방금 막 끝난 참입니다." },{ japanese: "息子は今出かけたところです。", korean: "아들은 지금 막 외출한 참입니다." }]},
            { id: 55, pattern: "~たまま", meaning: "~한 채로 (어떤 상태가 변하지 않고 지속됨)", examples: [{ japanese: "窓を開けたまま寝てしまいました。", korean: "창문을 연 채로 자 버렸습니다." },{ japanese: "靴を履いたまま部屋に入らないでください。", korean: "신발을 신은 채로 방에 들어가지 마세요." },{ japanese: "エアコンをつけたまま出かけてしまった。", korean: "에어컨을 켠 채로 외출해 버렸다." }]},
            { id: 56, pattern: "~ため(に)", meaning: "~하기 위해서 (목적) / ~때문에 (이유, 원인)", examples: [{ japanese: "大学に入るために、一生懸命勉強しています。", korean: "대학에 들어가기 위해서 열심히 공부하고 있습니다. (목적)" },{ japanese: "事故があったために、電車が遅れています。", korean: "사고가 있었기 때문에 전철이 늦어지고 있습니다. (이유)" },{ japanese: "病気のため、タバコをやめます。", korean: "병 때문에 담배를 끊습니다. (이유)" }]},
            { id: 57, pattern: "~たら", meaning: "~하면, ~라면 (가정 조건) / ~했더니 (결과 발견)", examples: [{ japanese: "もし雨だったら、ピクニックは中止です。", korean: "만약 비라면 소풍은 중지입니다." },{ japanese: "東京に着いたら、電話してください。", korean: "도쿄에 도착하면 전화해주세요." },{ japanese: "窓を開けたら、涼しい風が入ってきた。", korean: "창문을 열었더니 시원한 바람이 들어왔다." }]},
            { id: 58, pattern: "~だろう", meaning: "~일 것이다 (추측, ~でしょう의 보통체)", examples: [{ japanese: "明日はたぶんいい天気だろう。", korean: "내일은 아마 좋은 날씨일 것이다." },{ japanese: "彼はもうすぐ来るだろう。", korean: "그는 이제 곧 올 것이다." },{ japanese: "この時間なら、店はまだ開いているだろう。", korean: "이 시간이라면 가게는 아직 열려 있을 것이다." }]},
            { id: 59, pattern: "~ちゃ / ~じゃ / ~なくちゃ / ~なきゃ", meaning: "~ては / ~では / ~なくては / ~なければ의 축약형", examples: [{ japanese: "そんなことしちゃだめだよ。", korean: "그런 짓 하면 안 돼. (しては)" },{ japanese: "もう行かなくちゃ。", korean: "이제 가야 해. (行かなくては)" },{ japanese: "早く起きなきゃ遅刻するよ。", korean: "일찍 일어나지 않으면 지각해. (起きなければ)" }]},
            { id: 60, pattern: "~ちゅう (中) / ~じゅう (中)", meaning: "~중 (어떤 동작이나 상태가 진행 중) / ~동안 내내 (기간 전체)", examples: [{ japanese: "社長は今会議中です。", korean: "사장님은 지금 회의 중입니다. (ちゅう)" },{ japanese: "一日中雨が降っていました。", korean: "하루 종일 비가 내렸습니다. (じゅう)" },{ japanese: "資料を今週中に作ってください。", korean: "자료를 이번 주 중으로 만들어 주세요. (ちゅう)" }]},
            { id: 61, pattern: "~つづける (続ける)", meaning: "계속 ~하다 (동작의 지속, 동사 ます형 어간 + 続ける)", examples: [{ japanese: "雨が三日間降り続いています。", korean: "비가 3일간 계속 내리고 있습니다." },{ japanese: "彼は諦めずに努力し続けた。", korean: "그는 포기하지 않고 계속 노력했다." },{ japanese: "2時間も歩き続けたので、疲れました。", korean: "2시간이나 계속 걸었기 때문에 지쳤습니다." }]},
            { id: 62, pattern: "~つもりだ", meaning: "~할 생각이다, ~할 작정이다 (의도, 계획)", examples: [{ japanese: "来年、留学するつもりです。", korean: "내년에 유학할 생각입니다." },{ japanese: "この仕事は最後までやり遂げるつもりだ。", korean: "이 일은 마지막까지 해낼 작정이다." },{ japanese: "明日はどこへも行かないつもりです。", korean: "내일은 아무데도 가지 않을 생각입니다." }]},
            { id: 63, pattern: "~て・で (접속)", meaning: "~하고, ~해서 (동작의 연속, 원인·이유, 수단·방법 등)", examples: [{ japanese: "朝起きて、顔を洗います。", korean: "아침에 일어나서 세수를 합니다. (연속)" },{ japanese: "風邪をひいて、学校を休みました。", korean: "감기에 걸려서 학교를 쉬었습니다. (이유)" },{ japanese: "バスに乗って、駅まで行きました。", korean: "버스를 타고 역까지 갔습니다. (수단)" }]},
            { id: 64, pattern: "~てあげる", meaning: "~해 주다 (남에게 이익이 되는 행위를 함)", examples: [{ japanese: "友達に宿題を手伝ってあげました。", korean: "친구의 숙제를 도와주었습니다." },{ japanese: "妹に本を読んであげました。", korean: "여동생에게 책을 읽어 주었습니다." },{ japanese: "おばあさんの荷物を持ってあげました。", korean: "할머니의 짐을 들어 드렸습니다." }]},
            { id: 65, pattern: "~ていく", meaning: "~해 가다 (변화의 지속, 현재에서 미래로의 이동/계속)", examples: [{ japanese: "だんだん暖かくなっていきますね。", korean: "점점 따뜻해져 가네요. (변화)" },{ japanese: "これからも日本語の勉強を続けていくつもりです。", korean: "앞으로도 일본어 공부를 계속해 나갈 생각입니다. (계속)" },{ japanese: "友達の結婚式に着ていく服を買った。", korean: "친구 결혼식에 입고 갈 옷을 샀다. (이동)" }]},
            { id: 66, pattern: "~ていただく", meaning: "~해 받다, ~해 주시다 (남이 나에게 해주는 행위에 대한 감사, 겸양)", examples: [{ japanese: "先生に日本語を教えていただきました。", korean: "선생님께 일본어를 가르침 받았습니다. (선생님께서 일본어를 가르쳐 주셨습니다.)" },{ japanese: "駅までの道を教えていただけませんか。", korean: "역까지 가는 길을 가르쳐 주시지 않겠습니까?" },{ japanese: "写真を取っていただけませんか。", korean: "사진을 찍어주시지 않겠습니까?" }]},
            { id: 67, pattern: "~ている / ~てある", meaning: "~하고 있다, ~되어 있다 (진행, 상태) / ~해져 있다 (결과 상태, 인위적)", examples: [{ japanese: "窓が開いています。", korean: "창문이 열려 있습니다. (ている - 상태)" },{ japanese: "今、本を読んでいます。", korean: "지금 책을 읽고 있습니다. (ている - 진행)" },{ japanese: "テーブルの上にコップが置いてあります。", korean: "테이블 위에 컵이 놓여져 있습니다. (てある - 결과 상태)" }]},
            { id: 68, pattern: "~ているところだ", meaning: "~하고 있는 중이다 (동작이 현재 진행 중임을 강조)", examples: [{ japanese: "今、料理を作っているところです。", korean: "지금 요리를 만들고 있는 중입니다." },{ japanese: "ちょうど電話しようと思っていたところです。", korean: "마침 전화하려고 생각하고 있던 참입니다." },{ japanese: "会議は今、始まっているところです。", korean: "회의는 지금 시작되고 있는 중입니다." }]},
            { id: 69, pattern: "~ておく", meaning: "~해 놓다, ~해 두다 (준비, 조치, 방치)", examples: [{ japanese: "旅行の前に、ホテルを予約しておきます。", korean: "여행 전에 호텔을 예약해 둡니다. (준비)" },{ japanese: "窓を開けておいてください。", korean: "창문을 열어 두세요. (조치/방치)" },{ japanese: "このことはよく覚えておいてください。", korean: "이것은 잘 기억해 두세요. (조치)" }]},
            { id: 70, pattern: "~てから / ~たあとで / ~前に", meaning: "~하고 나서 / ~한 후에 / ~하기 전에", examples: [{ japanese: "手を洗ってから食事をします。", korean: "손을 씻고 나서 식사를 합니다." },{ japanese: "映画を見たあとで、お茶を飲みました。", korean: "영화를 본 후에 차를 마셨습니다." },{ japanese: "寝る前に歯を磨きます。", korean: "자기 전에 이를 닦습니다." }]},
            { id: 71, pattern: "~てくださる / ~てくださいませんか", meaning: "~해 주시다 (높임) / ~해 주시지 않겠습니까? (정중한 의뢰)", examples: [{ japanese: "先生がこの本を貸してくださいました。", korean: "선생님께서 이 책을 빌려주셨습니다." },{ japanese: "駅までの道を教えてくださいませんか。", korean: "역까지 가는 길을 가르쳐 주시지 않겠습니까?" },{ japanese: "写真を取ってくださいませんか。", korean: "사진을 찍어주시지 않겠습니까?" }]},
            { id: 72, pattern: "~てくる", meaning: "~해 오다 (과거에서 현재로의 변화/계속), (어떤 동작을 하고) 오다", examples: [{ japanese: "だんだん寒くなってきました。", korean: "점점 추워져 왔습니다. (변화)" },{ japanese: "郵便局へ行ってきます。", korean: "우체국에 갔다 오겠습니다. (동작 후 옴)" },{ japanese: "日本語の勉強をずっと続けてきました。", korean: "일본어 공부를 쭉 계속해 왔습니다. (계속)" }]},
            { id: 73, pattern: "~てくれる", meaning: "~해 주다 (남이 나 또는 내 주변 사람에게 이익이 되는 행위를 함)", examples: [{ japanese: "友達が宿題を手伝ってくれました。", korean: "친구가 숙제를 도와주었습니다." },{ japanese: "母が美味しい料理を作ってくれた。", korean: "어머니가 맛있는 요리를 만들어 주었다." },{ japanese: "駅員さんが親切に道を教えてくれた。", korean: "역무원분이 친절하게 길을 가르쳐 주었다." }]},
            { id: 74, pattern: "~てしまう", meaning: "~해 버리다, ~하고 말다 (완료, 유감, 후회)", examples: [{ japanese: "宿題を全部してしまいました。", korean: "숙제를 전부 해 버렸습니다. (완료)" },{ japanese: "財布を忘れてしまいました。", korean: "지갑을 잊어버리고 말았습니다. (유감)" },{ japanese: "大切なコップを割ってしまった。", korean: "소중한 컵을 깨뜨려 버렸다. (후회)" }]},
            { id: 75, pattern: "~てはいけない", meaning: "~해서는 안 된다 (금지)", examples: [{ japanese: "ここでタバコを吸ってはいけません。", korean: "여기서 담배를 피워서는 안 됩니다." },{ japanese: "図書館では大きい声で話してはいけません。", korean: "도서관에서는 큰 소리로 이야기해서는 안 됩니다." },{ japanese: "人の物を盗んではいけません。", korean: "남의 물건을 훔쳐서는 안 됩니다." }]},
            { id: 76, pattern: "~てみる", meaning: "(시험 삼아) ~해 보다", examples: [{ japanese: "この服を着てみてもいいですか。", korean: "이 옷을 입어봐도 괜찮습니까?" },{ japanese: "新しいレストランへ行ってみました。", korean: "새로운 레스토랑에 가 보았습니다." },{ japanese: "一度やってみないと、できるかどうかわからない。", korean: "한번 해보지 않으면 할 수 있을지 어떨지 모른다." }]},
            { id: 77, pattern: "~ても", meaning: "~하더라도, ~해도 (역접, 양보)", examples: [{ japanese: "雨が降っても、試合は行われます。", korean: "비가 와도 시합은 진행됩니다." },{ japanese: "いくら練習しても、上手になりません。", korean: "아무리 연습해도 능숙해지지 않습니다." },{ japanese: "このような言葉は辞書を引いても分かりません。", korean: "이러한 말은 사전을 찾아도 모르겠습니다." }]},
            { id: 78, pattern: "~てもいい", meaning: "~해도 좋다, ~해도 된다 (허가, 허용)", examples: [{ japanese: "この部屋でタバコを吸ってもいいですか。", korean: "이 방에서 담배를 피워도 괜찮습니까?" },{ japanese: "もう帰ってもいいですよ。", korean: "이제 돌아가도 괜찮아요." },{ japanese: "みかんを食べてもいい？", korean: "귤 먹어도 돼?" }]},
            { id: 79, pattern: "~てもかまわない", meaning: "~해도 상관없다, ~해도 괜찮다 (허가, 허용, ~てもいい보다 조금 더 관대한 느낌)", examples: [{ japanese: "汚れてもかまいません。", korean: "더러워져도 상관없습니다." },{ japanese: "ここで何を話してもかまいません。", korean: "여기서는 무엇을 이야기해도 괜찮습니다." },{ japanese: "今使っていないから、使ってもかまいません。", korean: "지금 사용하지 않으니까 사용해도 상관없습니다." }]},
            { id: 80, pattern: "~てもらう", meaning: "~해 받다 (남에게 어떤 행위를 하도록 하여 자신이 이익을 얻음)", examples: [{ japanese: "友達に宿題を手伝ってもらいました。", korean: "친구에게 숙제를 도움 받았습니다. (친구가 숙제를 도와주었습니다.)" },{ japanese: "先生に推薦状を書いてもらいました。", korean: "선생님께 추천장을 써 받았습니다. (선생님께서 추천장을 써 주셨습니다.)" },{ japanese: "他の人に聞いてもらえますか。", korean: "다른 사람에게 물어봐 주시겠어요?" }]},
            { id: 81, pattern: "~てやる", meaning: "~해 주다 (손아랫사람, 동물, 식물 등에게 이익이 되는 행위를 함)", examples: [{ japanese: "弟に宿題を教えてやりました。", korean: "남동생에게 숙제를 가르쳐 주었습니다." },{ japanese: "犬に餌をやってください。", korean: "개에게 먹이를 주세요." },{ japanese: "子供を動物園へ連れていってやった。", korean: "아이를 동물원에 데려가 주었다." }]},
            { id: 82, pattern: "~と (조건)", meaning: "~하면, ~하자 (필연적인 결과, 습관, 발견)", examples: [{ japanese: "春になると、花が咲きます。", korean: "봄이 되면 꽃이 핍니다. (필연적 결과)" },{ japanese: "このボタンを押すと、ドアが開きます。", korean: "이 버튼을 누르면 문이 열립니다. (필연적 결과)" },{ japanese: "窓を開けると、海が見えました。", korean: "창문을 열자 바다가 보였습니다. (발견)" }]},
            { id: 83, pattern: "~と~とどちら", meaning: "~와 ~중 어느 쪽 (비교 선택)", examples: [{ japanese: "りんごとバナナとどちらが好きですか。", korean: "사과와 바나나 중 어느 쪽을 좋아합니까?" },{ japanese: "買ってきて食べるのと店に食べにいくのとどちらがいいですか。", korean: "사와서 먹는 것과 가게에 가서 먹는 것 중 어느 쪽이 좋습니까?" },{ japanese: "コーラとジュースとどちらにしますか。", korean: "콜라와 주스 중 어느 것으로 하시겠습니까?" }]},
            { id: 84, pattern: "~とき", meaning: "~때 (시간)", examples: [{ japanese: "宿題で答えが分からないとき、先生に聞きます。", korean: "숙제에서 답을 모를 때, 선생님께 여쭤봅니다." },{ japanese: "父は本を読むとき、いつもめがねをかけます。", korean: "아버지는 책을 읽을 때, 항상 안경을 쓰십니다." },{ japanese: "初めてこの携帯電話を持ったとき、とても嬉しかった。", korean: "처음 이 휴대전화를 가졌을 때, 매우 기뻤습니다." }]},
            { id: 85, pattern: "~ところだ (사전형)", meaning: "~하려는 참이다 (동작 직전)", examples: [{ japanese: "今からご飯を食べるところです。", korean: "지금부터 밥을 먹으려는 참입니다." },{ japanese: "これから学校へ行くところだ。", korean: "이제부터 학교에 가려는 참이다." },{ japanese: "今から母に電話をかけるところです。", korean: "지금부터 어머니에게 전화를 걸려는 참입니다." }]},
            { id: 86, pattern: "~とちゅうで (途中で)", meaning: "~도중에", examples: [{ japanese: "学校に来る途中で財布を忘れたのに気づいた。", korean: "학교에 오는 도중에 지갑을 두고 온 것을 깨달았다." },{ japanese: "大事な話の途中で電話が鳴った。", korean: "중요한 이야기 도중에 전화가 울렸다." },{ japanese: "彼は式典の途中で退席した。", korean: "그는 식전 도중에 자리를 떴다." }]},
            { id: 87, pattern: "どんなに~ても", meaning: "아무리 ~해도", examples: [{ japanese: "どんなに練習しても、ピアノが上手になりません。", korean: "아무리 연습해도 피아노가 능숙해지지 않습니다." },{ japanese: "どんなに探しても見つからない。", korean: "아무리 찾아도 발견되지 않는다." },{ japanese: "どんなに忙しくても、食事はちゃんと取ります。", korean: "아무리 바빠도 식사는 제대로 합니다." }]},
            { id: 88, pattern: "~なくてはいけない / ~なければならない", meaning: "~하지 않으면 안 된다, ~해야 한다 (의무, 필요)", examples: [{ japanese: "宿題は必ずしなくてはいけない。", korean: "숙제는 반드시 해야 한다." },{ japanese: "明日までにこのレポートを仕上げなければならない。", korean: "내일까지 이 리포트를 완성해야 한다." },{ japanese: "会議に出なければならなくなりました。", korean: "회의에 참석하지 않으면 안 되게 되었습니다." }]},
            { id: 89, pattern: "~なくてもいい", meaning: "~하지 않아도 좋다 (불필요)", examples: [{ japanese: "その本は今日返さなくてもいいです。", korean: "그 책은 오늘 돌려주지 않아도 됩니다." },{ japanese: "時間があるから、急がなくてもいいですよ。", korean: "시간이 있으니까 서두르지 않아도 괜찮아요." },{ japanese: "分からなければ書かなくてもいいです。", korean: "모르면 쓰지 않아도 됩니다." }]},
            { id: 90, pattern: "~なくてもかまわない", meaning: "~하지 않아도 상관없다 (불필요, 허용)", examples: [{ japanese: "明日は手伝いに来なくてもかまわない。", korean: "내일은 도와주러 오지 않아도 괜찮다." },{ japanese: "飲めないのなら、無理に飲まなくてもかまいません。", korean: "마실 수 없다면 억지로 마시지 않아도 괜찮습니다." },{ japanese: "この仕事は日本語が上手でなくてもかまいません。", korean: "이 일은 일본어를 잘하지 않아도 괜찮습니다." }]},
            { id: 91, pattern: "~なさい", meaning: "~해라, ~하시오 (가벼운 명령, 주로 손아랫사람에게)", examples: [{ japanese: "早くここに来なさい。", korean: "빨리 여기로 와라." },{ japanese: "この本を読みなさい。", korean: "이 책을 읽어라." },{ japanese: "ご飯を食べた後でこの薬を飲みなさい。", korean: "밥을 먹은 후에 이 약을 먹어라." }]},
            { id: 92, pattern: "~なら", meaning: "~라면, ~한다면 (가정, 조건, 화제 제시)", examples: [{ japanese: "パソコンのことなら、山田さんに聞いてください。", korean: "컴퓨터에 관한 것이라면 야마다 씨에게 물어보세요." },{ japanese: "日本料理なら、あの店が美味しいですよ。", korean: "일본 요리라면 저 가게가 맛있어요." },{ japanese: "タクシーなら、ここから15分ぐらいで行けると思います。", korean: "택시라면 여기서 15분 정도면 갈 수 있을 거라고 생각합니다." }]},
            { id: 93, pattern: "~にくい", meaning: "~하기 어렵다 (동사 ます형 어간 + にくい)", examples: [{ japanese: "このペンは書きにくいです。", korean: "이 펜은 쓰기 어렵습니다." },{ japanese: "彼の説明は分かりにくい。", korean: "그의 설명은 이해하기 어렵다." },{ japanese: "この靴は歩きにくいです。", korean: "이 신발은 걷기 어렵습니다." }]},
            { id: 94, pattern: "~にする", meaning: "~으로 하다, ~로 정하다 (선택, 결정)", examples: [{ japanese: "私はコーヒーにします。", korean: "저는 커피로 하겠습니다." },{ japanese: "今日の夕食はカレーにしよう。", korean: "오늘 저녁은 카레로 하자." },{ japanese: "プレゼントはネクタイにしましょう。", korean: "선물은 넥타이로 합시다." }]},
            { id: 95, pattern: "~について", meaning: "~에 관해서, ~에 대해서", examples: [{ japanese: "日本の文化について勉強しています。", korean: "일본 문화에 관해서 공부하고 있습니다." },{ japanese: "その事件について何か知っていますか。", korean: "그 사건에 대해서 뭔가 알고 있습니까?" },{ japanese: "池田さんは鳥についての講演をしました。", korean: "이케다 씨는 새에 관한 강연을 했습니다." }]},
            { id: 96, pattern: "~によって", meaning: "~에 의해서 (수단, 원인), ~에 따라서 (경우)", examples: [{ japanese: "この橋は外国人によって作られました。", korean: "이 다리는 외국인에 의해서 만들어졌습니다." },{ japanese: "人によって考え方が違います。", korean: "사람에 따라서 사고방식이 다릅니다." },{ japanese: "天気予報によると今日は雷雨があるそうだ。", korean: "일기예보에 의하면 오늘은 뇌우가 있다고 한다." }]},
            { id: 97, pattern: "~のだ / ~んだ", meaning: "~인 것이다 (설명, 이유, 강조)", examples: [{ japanese: "どうして遅れたんですか。事故があったのです。", korean: "왜 늦었습니까? 사고가 있었던 것입니다." },{ japanese: "彼は来ないんだ。きっと何かあったんだろう。", korean: "그는 오지 않는 거야. 분명 무슨 일이 있었겠지." },{ japanese: "だから最近急いで帰っているんですね。", korean: "그래서 요즘 서둘러 집에 가는 거로군요." }]},
            { id: 98, pattern: "~ば", meaning: "~하면 (가정 조건)", examples: [{ japanese: "この薬を飲めば、すぐ治りますよ。", korean: "이 약을 먹으면 바로 나을 거예요." },{ japanese: "時間があれば、映画を見に行きたいです。", korean: "시간이 있다면 영화를 보러 가고 싶습니다." },{ japanese: "どう行けばいいですか。", korean: "어떻게 가면 됩니까?" }]},
            { id: 99, pattern: "~はじめる (始める)", meaning: "~하기 시작하다 (동작의 개시, 동사 ます형 어간 + 始める)", examples: [{ japanese: "雨が降り始めました。", korean: "비가 내리기 시작했습니다." },{ japanese: "赤ちゃんがやっと歩き始めた。", korean: "아기가 드디어 걷기 시작했다." },{ japanese: "ベルが鳴ると、学生たちは答えを書き始めました。", korean: "벨이 울리자 학생들은 답을 쓰기 시작했습니다." }]},
            { id: 100, pattern: "~はずがない", meaning: "~할 리가 없다 (강한 부정적 추측)", examples: [{ japanese: "彼がそんなことをするはずがない。", korean: "그가 그런 일을 할 리가 없다." },{ japanese: "こんなところにいるはずがない。", korean: "이런 곳에 있을 리가 없다." },{ japanese: "子供がそんな重い物が持てるはずがありません。", korean: "어린이가 그렇게 무거운 것을 들 수 있을 리가 없습니다." }]},
            // 새로 추가될 데이터 (101 ~ 115)
            {
                id: 101,
                pattern: "~はずだ",
                meaning: "~일 것이다, ~일 터이다 (필연적 추측, 당연함)",
                examples: [
                    { japanese: "彼はきっと来るはずだ。", korean: "그는 분명 올 것이다." },
                    { japanese: "ここに靴があるから、山田さんはまだ学校にいるはずです。", korean: "여기에 신발이 있으니까 야마다 씨는 아직 학교에 있을 것입니다." },
                    { japanese: "計画によると、この仕事は今度の春までに終わるはずです。", korean: "계획에 따르면 이 일은 이번 봄까지 끝날 것입니다." }
                ]
            },
            {
                id: 102,
                pattern: "~は~より",
                meaning: "~은/는 ~보다 (비교)",
                examples: [
                    { japanese: "今日は昨日より暖かいです。", korean: "오늘은 어제보다 따뜻합니다." },
                    { japanese: "この靴はあの靴より歩きやすい。", korean: "이 신발은 저 신발보다 걷기 편하다." },
                    { japanese: "この町の人口は去年より多くなりました。", korean: "이 도시의 인구는 작년보다 많아졌습니다." }
                ]
            },
            {
                id: 103,
                pattern: "~ほうがいい",
                meaning: "~하는 편이 좋다 (권고, 조언)",
                examples: [
                    { japanese: "タバコはやめたほうがいいですよ。", korean: "담배는 끊는 편이 좋아요." },
                    { japanese: "少し休んだほうがいいです。", korean: "조금 쉬는 편이 좋습니다." },
                    { japanese: "大事なことは話さないほうがいいです。", korean: "중요한 것은 이야기하지 않는 편이 좋습니다." }
                ]
            },
            {
                id: 104,
                pattern: "~ほど~ない",
                meaning: "~만큼 ~하지 않다 (비교, 부정)",
                examples: [
                    { japanese: "大阪は東京ほど大きくありません。", korean: "오사카는 도쿄만큼 크지 않습니다." },
                    { japanese: "今年の試験は去年ほど難しくないと思います。", korean: "올해 시험은 작년만큼 어렵지 않다고 생각합니다." },
                    { japanese: "弟は私ほど走るのが速くない。", korean: "남동생은 나만큼 달리기가 빠르지 않다." }
                ]
            },
            {
                id: 105,
                pattern: "~みたいに / ~みたいだ",
                meaning: "~처럼 / ~인 것 같다 (비유, 추측)",
                examples: [
                    { japanese: "子供みたいに喜んでいます。", korean: "아이처럼 기뻐하고 있습니다." },
                    { japanese: "あの人形はまるで生きているみたいだ。", korean: "저 인형은 마치 살아있는 것 같다." },
                    { japanese: "高木さんはコンピューターみたいに計算が速い。", korean: "타카기 씨는 컴퓨터처럼 계산이 빠르다." }
                ]
            },
            {
                id: 106,
                pattern: "~やすい",
                meaning: "~하기 쉽다, ~하기 편하다 (동사 ます형 어간 + やすい)",
                examples: [
                    { japanese: "このペンは書きやすいです。", korean: "이 펜은 쓰기 편합니다." },
                    { japanese: "東京は生活しやすいところだ。", korean: "도쿄는 생활하기 편한 곳이다." },
                    { japanese: "この靴は軽くて歩きやすいです。", korean: "이 신발은 가벼워서 걷기 편합니다." }
                ]
            },
            {
                id: 107,
                pattern: "~ようだ",
                meaning: "~인 것 같다 (추측, 비유, 예시)",
                examples: [
                    { japanese: "彼は病気のようだ。", korean: "그는 아픈 것 같다. (추측)" },
                    { japanese: "鳥のように空を飛べたらいいなあ。", korean: "새처럼 하늘을 날 수 있다면 좋을 텐데. (비유)" },
                    { japanese: "例えば、りんごのような赤い果物。", korean: "예를 들면 사과 같은 빨간 과일. (예시)" }
                ]
            },
            {
                id: 108,
                pattern: "~ように / ~ように言う",
                meaning: "~하도록 / ~하도록 말하다 (목표, 지시, 전달)",
                examples: [
                    { japanese: "忘れないようにメモしてください。", korean: "잊지 않도록 메모해주세요." },
                    { japanese: "先生は生徒に早く来るように言いました。", korean: "선생님은 학생에게 빨리 오도록 말했습니다." },
                    { japanese: "山田さんにすぐ本を返すように言ってください。", korean: "야마다 씨에게 바로 책을 돌려주도록 말해주세요." }
                ]
            },
            {
                id: 109,
                pattern: "~ようにする / ~ようになる",
                meaning: "~하도록 하다 (노력, 습관) / ~하게 되다 (변화, 가능)",
                examples: [
                    { japanese: "毎日野菜を食べるようにしています。", korean: "매일 야채를 먹도록 하고 있습니다. (노력, 습관)" },
                    { japanese: "日本語が話せるようになりました。", korean: "일본어를 할 수 있게 되었습니다. (변화, 가능)" },
                    { japanese: "あしたは寝坊しないようにします。", korean: "내일은 늦잠 자지 않도록 하겠습니다. (노력)" }
                ]
            },
            {
                id: 110,
                pattern: "~より~ほうが",
                meaning: "~보다 ~쪽이 (더) (비교)",
                examples: [
                    { japanese: "電車よりバスのほうが安いです。", korean: "전철보다 버스 쪽이 더 쌉니다." },
                    { japanese: "自分で作るよりレストランで食べるほうがいい。", korean: "직접 만드는 것보다 레스토랑에서 먹는 편이 좋다." },
                    { japanese: "あの店よりこの店のほうが品物が多いです。", korean: "저 가게보다 이 가게 쪽이 물건이 많습니다." }
                ]
            },
            {
                id: 111,
                pattern: "~らしい",
                meaning: "~인 것 같다 (객관적 근거에 의한 추측), ~답다",
                examples: [
                    { japanese: "明日は雪が降るらしいです。", korean: "내일은 눈이 내릴 것 같습니다." },
                    { japanese: "田中さんは中国語ができるらしいです。", korean: "다나카 씨는 중국어를 할 수 있는 것 같습니다." },
                    { japanese: "あの人は本当に男らしい人だと思います。", korean: "저 사람은 정말 남자다운 사람이라고 생각합니다." }
                ]
            },
            {
                id: 112,
                pattern: "~(ら)れる (수동)",
                meaning: "~되다, ~당하다 (수동)",
                examples: [
                    { japanese: "弟にケーキを食べられました。", korean: "남동생에게 케이크를 먹힘 당했습니다. (남동생이 케이크를 먹었다.)" },
                    { japanese: "先生に褒められました。", korean: "선생님께 칭찬받았습니다." },
                    { japanese: "この本は多くの人に読まれています。", korean: "이 책은 많은 사람에게 읽히고 있습니다." }
                ]
            },
            {
                id: 113,
                pattern: "~(ら)れる (가능)",
                meaning: "~할 수 있다 (가능)",
                examples: [
                    { japanese: "私は納豆が食べられます。", korean: "저는 낫토를 먹을 수 있습니다." },
                    { japanese: "自転車に乗れますか。", korean: "자전거를 탈 수 있습니까?" },
                    { japanese: "忙しくて、なかなか友達と会えない。", korean: "바빠서 좀처럼 친구와 만날 수 없다." }
                ]
            },
            {
                id: 114,
                pattern: "명령형",
                meaning: "~해라 (강한 명령)",
                examples: [
                    { japanese: "早く起きろ。学校に遅れるよ。", korean: "빨리 일어나. 학교에 늦겠어." },
                    { japanese: "あそこへ行け。", korean: "저기로 가라." },
                    { japanese: "静かにしろ。", korean: "조용히 해라." }
                ]
            },
            {
                id: 115,
                pattern: "지시어 및 연체사 (こんな、そんな、あんな、どんな、こういう、そういう、ああいう、どういう)",
                meaning: "이런, 그런, 저런, 어떤 / 이러한, 그러한, 저러한, 어떠한",
                examples: [
                    { japanese: "こんな話は初めて聞きます。", korean: "이런 이야기는 처음 듣습니다." },
                    { japanese: "そんなに心配しないでください。", korean: "그렇게 걱정하지 마세요." },
                    { japanese: "どんなコンピューターでも使えますよ。", korean: "어떤 컴퓨터라도 사용할 수 있어요." }
                ]
            }
        ];

        let currentCardIndex = 0;
        let detailsVisible = false;
        let memorizedStatus = {};
        let isAutoPlaying = false;
        let speechQueue = [];
        let currentSpeechUtteranceIndex = 0;
        const synth = window.speechSynthesis;
        let voices = [];
        let preferredKoreanVoice = null; // 선호 한국어 목소리
        let preferredJapaneseVoice = null; // 선호 일본어 목소리

        const grammarIdEl = document.getElementById('grammarId');
        const grammarPatternEl = document.getElementById('grammarPattern');
        const grammarMeaningEl = document.getElementById('grammarMeaning');
        const grammarExamplesEl = document.getElementById('grammarExamples');
        const revealButton = document.getElementById('revealButton');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const meaningContainerEl = document.getElementById('meaningContainer');
        const examplesContainerEl = document.getElementById('examplesContainer');
        const toggleMemorizedButtonEl = document.getElementById('toggleMemorizedButton');
        const showAllButtonEl = document.getElementById('showAllButton');
        const modalEl = document.getElementById('allGrammarModal');
        const closeModalButtonEl = document.getElementById('closeModalButton');
        const allGrammarListEl = document.getElementById('allGrammarList');
        const playPauseButtonEl = document.getElementById('playPauseButton');

        function getJapaneseNumberString(num) {
            return String(num); 
        }

        function loadVoices() {
            voices = synth.getVoices();
            // console.log("Available voices:", voices); // 사용 가능한 전체 목소리 목록을 보려면 이 줄의 주석을 해제하세요.

            // --- 선호 목소리 선택 로직 ---
            // 아래 목소리 이름들은 예시이며, 실제 환경에 따라 다를 수 있습니다.
            // "젊고 말 잘하는 여성 목소리"는 주관적일 수 있으므로,
            // 일반적으로 선호되는 고품질 음성이나 'Female', '여성' 등의 키워드를 포함하는 이름을 우선적으로 찾습니다.

            // 한국어 여성 목소리 우선 순위
            const koreanVoicePreferences = [
                // Windows (Edge, Chrome 등)
                'Microsoft Heami Online (Natural) - Korean (Korea)', // Edge 최신 자연스러운 음성
                'Google 한국의 여성', // Chrome
                // macOS
                'Yuna (Enhanced)', // macOS 고품질 한국어
                'Sora (Enhanced)',
                'Yuna',
                'Sora',
                // Android (제조사나 버전에 따라 다름)
                // 'Samsung Korean Female', (예시)
                // 'LG Korean Female', (예시)
            ];
            for (const name of koreanVoicePreferences) {
                const voice = voices.find(v => v.lang === 'ko-KR' && v.name === name);
                if (voice) {
                    preferredKoreanVoice = voice;
                    break;
                }
            }
            if (!preferredKoreanVoice) { // 이름으로 못찾으면 'Female' 또는 '여성' 포함된 이름으로 검색
                preferredKoreanVoice = voices.find(v => v.lang === 'ko-KR' && (v.name.toLowerCase().includes('female') || v.name.includes('여성')));
            }
            if (!preferredKoreanVoice) { // 그래도 없으면 그냥 첫번째 ko-KR 목소리
                preferredKoreanVoice = voices.find(v => v.lang === 'ko-KR');
            }

            // 일본어 여성 목소리 우선 순위
            const japaneseVoicePreferences = [
                // Windows (Edge, Chrome 등)
                'Microsoft Ayumi Online (Natural) - Japanese (Japan)', // Edge 최신 자연스러운 음성
                'Microsoft Haruka Online (Natural) - Japanese (Japan)', // Edge 자연스러운 음성
                'Google 日本語', // Chrome (보통 여성 음성)
                'Microsoft Haruka Desktop - Japanese', // Windows 기본
                // macOS
                'Kyoko (Enhanced)', // macOS 고품질 일본어
                'Otoya (Enhanced)', // 남성일 수 있으나 고품질, 여성 이름으로 대체 가능
                'Kyoko',
                'Otoya', // 남성일 수 있음
                // Android
                // 'Samsung Japanese Female', (예시)
            ];
            for (const name of japaneseVoicePreferences) {
                const voice = voices.find(v => v.lang === 'ja-JP' && v.name === name);
                if (voice) {
                    preferredJapaneseVoice = voice;
                    break;
                }
            }
            if (!preferredJapaneseVoice) { // 이름으로 못찾으면 'Female' 또는 '女性' 포함된 이름으로 검색
                preferredJapaneseVoice = voices.find(v => v.lang === 'ja-JP' && (v.name.toLowerCase().includes('female') || v.name.includes('女性')));
            }
            if (!preferredJapaneseVoice) { // 그래도 없으면 그냥 첫번째 ja-JP 목소리
                preferredJapaneseVoice = voices.find(v => v.lang === 'ja-JP');
            }

            // console.log("Selected Korean Voice:", preferredKoreanVoice ? preferredKoreanVoice.name : "Not found/default");
            // console.log("Selected Japanese Voice:", preferredJapaneseVoice ? preferredJapaneseVoice.name : "Not found/default");
        }

        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        loadVoices(); // 초기 로드 시도 (onvoiceschanged가 즉시 발생하지 않을 수 있음)


        function speak(text, lang, callback) {
            if (synth.speaking) {
                synth.cancel();
            }
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang; // 언어 설정은 필수

            let targetVoice = null;
            if (lang === 'ko-KR') {
                targetVoice = preferredKoreanVoice;
            } else if (lang === 'ja-JP') {
                targetVoice = preferredJapaneseVoice;
            }

            if (targetVoice) {
                utterance.voice = targetVoice;
            } else {
                // 선호 목소리를 못 찾았거나 아직 voices 로드가 안된 경우, 해당 언어의 첫번째 목소리라도 다시 시도
                const fallbackVoice = voices.find(v => v.lang === lang);
                if (fallbackVoice) {
                    utterance.voice = fallbackVoice;
                }
                // console.warn(`Preferred voice for ${lang} not found. Using browser default or first available for the language.`);
            }
            
            // console.log(`Attempting to speak with voice: ${utterance.voice ? utterance.voice.name : 'Browser Default'} for lang ${lang}`);

            utterance.onend = () => {
                if (callback) callback();
            };
            utterance.onerror = (event) => {
                console.error('SpeechSynthesisUtterance.onerror - Event:', event);
                console.error('SpeechSynthesisUtterance.onerror - Error Code:', event.error); 
                if (event.error === 'canceled') {
                    // console.log("Speech was canceled.");
                } else if (isAutoPlaying) {
                     alert(`음성 재생 중 오류가 발생했습니다 (${event.error}). 자동 재생을 중지합니다. 브라우저의 음성 지원 기능을 확인해주세요.`);
                }
                
                if (isAutoPlaying && event.error !== 'canceled') {
                    stopAutoPlay();
                }
                if (callback) callback(); 
            };
            synth.speak(utterance);
        }
        
        function playCurrentCardAudio() {
            if (!isAutoPlaying) return;

            const card = grammarData[currentCardIndex];
            if (memorizedStatus[card.id]) {
                playNextCard();
                return;
            }

            speechQueue = [];
            currentSpeechUtteranceIndex = 0;

            speechQueue.push({ text: "カード" , lang: 'ja-JP' });
            speechQueue.push({ text: getJapaneseNumberString(card.id), lang: 'ja-JP' });
            speechQueue.push({ text: card.pattern, lang: 'ja-JP' });
            speechQueue.push({ text: "의미", lang: 'ko-KR' });
            const cleanedMeaning = cleanTextForSpeech(card.meaning);
            speechQueue.push({ text: cleanedMeaning, lang: 'ko-KR' });

            
            speechQueue.push({ text: "예문 시작", lang: 'ko-KR' });
            
            card.examples.forEach((ex, index) => {
                const nativeNumber = getNativeKoreanNumber(index + 1);
                speechQueue.push({ text: `예문 ${nativeNumber}번`, lang: 'ko-KR' });
                speechQueue.push({ text: ex.japanese, lang: 'ja-JP' });
                const cleanedKoreanExample = ex.korean.replace(/\([^)]*\)/g, '').trim();
                speechQueue.push({ text: cleanedKoreanExample, lang: 'ko-KR' });
            });
            
            playNextSpeechInQueue();
        }

        const nativeNumberMap = ['일', '이', '삼', '사', '오', '육', '칠', '팔', '구', '십'];

        function getNativeKoreanNumber(n) {
            if (n <= 10) return nativeNumberMap[n - 1];
            if (n < 20) return '십' + nativeNumberMap[n % 10 - 1];
            if (n % 10 === 0) return nativeNumberMap[n / 10 - 1] + '십';
            return nativeNumberMap[Math.floor(n / 10) - 1] + '십' + nativeNumberMap[n % 10 - 1];
        }

        function playNextSpeechInQueue() {
            if (!isAutoPlaying || currentSpeechUtteranceIndex >= speechQueue.length) {
                if (isAutoPlaying) { 
                    setTimeout(playNextCard, 700); 
                }
                return;
            }
            const speechItem = speechQueue[currentSpeechUtteranceIndex];
            speak(speechItem.text, speechItem.lang, () => {
                currentSpeechUtteranceIndex++;
                playNextSpeechInQueue();
            });
        }
        
        function cleanTextForSpeech(text) {
            return text
                .replace(/\([^)]*\)/g, '')         
                .replace(/[~!@#$%^&*_=+|\\:;"'<>,.?/]/g, '') 
                .replace(/\s+/g, ' ')              
                .trim();
        }

        function playNextCard() {
            if (!isAutoPlaying) return;
            currentCardIndex = (currentCardIndex + 1);
            if (currentCardIndex >= grammarData.length) {
                stopAutoPlay(); 
                alert("모든 카드 학습을 완료했습니다!");
                return;
            }
            displayCard(); 
            playCurrentCardAudio(); 
        }

        function startAutoPlay() {
            if (synth.speaking) { 
                synth.cancel(); 
            }
            isAutoPlaying = true;
            playPauseButtonEl.innerHTML = '<i class="fas fa-pause mr-1"></i> 일시 정지';
            currentSpeechUtteranceIndex = 0; 
            playCurrentCardAudio();
        }

        function stopAutoPlay() {
            isAutoPlaying = false;
            synth.cancel(); 
            speechQueue = [];
            currentSpeechUtteranceIndex = 0;
            playPauseButtonEl.innerHTML = '<i class="fas fa-play mr-1"></i> 자동 재생';
        }
        
        playPauseButtonEl.addEventListener('click', () => {
            if (isAutoPlaying) {
                stopAutoPlay();
            } else {
                startAutoPlay();
            }
        });

        function loadMemorizedStatus() {
            const storedStatus = localStorage.getItem('japaneseGrammarMemorizedStatus');
            if (storedStatus) {
                memorizedStatus = JSON.parse(storedStatus);
            }
        }

        function saveMemorizedStatus() {
            localStorage.setItem('japaneseGrammarMemorizedStatus', JSON.stringify(memorizedStatus));
        }

        function updateMemorizedButton() {
            const card = grammarData[currentCardIndex];
            if (memorizedStatus[card.id]) {
                toggleMemorizedButtonEl.textContent = '암기 ✅';
                toggleMemorizedButtonEl.classList.remove('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
                toggleMemorizedButtonEl.classList.add('bg-green-200', 'hover:bg-green-300', 'text-green-700');
            } else {
                toggleMemorizedButtonEl.textContent = '암기 ❌';
                toggleMemorizedButtonEl.classList.remove('bg-green-200', 'hover:bg-green-300', 'text-green-700');
                toggleMemorizedButtonEl.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700');
            }
        }
        
        function displayCard() {
            const card = grammarData[currentCardIndex];
            grammarIdEl.textContent = `ID: ${String(card.id).padStart(3, '0')}`;
            grammarPatternEl.textContent = card.pattern;
            grammarMeaningEl.textContent = card.meaning;
            
            grammarExamplesEl.innerHTML = ''; 
            card.examples.forEach((ex, index) => {
                const exDiv = document.createElement('div');
                exDiv.classList.add('example-item', 'bg-gray-50', 'p-3', 'rounded-md');
                
                const jpP = document.createElement('p');
                jpP.classList.add('text-indigo-600', 'font-medium', 'text-sm', 'sm:text-base', 'md:text-lg');
                jpP.textContent = ex.japanese;
                jpP.addEventListener('click', () => speakExample(ex.japanese, ex.korean.replace(/\([^)]*\)/g, '').trim()));
                
                const krP = document.createElement('p');
                krP.classList.add('text-gray-600', 'text-xs', 'sm:text-sm', 'mt-1');
                krP.textContent = ex.korean;
                krP.addEventListener('click', () => speakExample(ex.japanese, ex.korean.replace(/\([^)]*\)/g, '').trim()));
                
                exDiv.appendChild(jpP);
                exDiv.appendChild(krP);
                grammarExamplesEl.appendChild(exDiv);
            });

            hideDetails(); 
            updateMemorizedButton();
        }

        function speakExample(japaneseText, koreanText) {
            if (isAutoPlaying) stopAutoPlay(); 
            synth.cancel(); 
            speechQueue = [
                { text: japaneseText, lang: 'ja-JP' },
                { text: koreanText, lang: 'ko-KR' }
            ];
            currentSpeechUtteranceIndex = 0;
            playNextSpeechInQueueForExample();
        }

        function playNextSpeechInQueueForExample() {
             if (currentSpeechUtteranceIndex >= speechQueue.length) {
                return; 
            }
            const speechItem = speechQueue[currentSpeechUtteranceIndex];
            speak(speechItem.text, speechItem.lang, () => {
                currentSpeechUtteranceIndex++;
                playNextSpeechInQueueForExample();
            });
        }

        function hideDetails() {
            meaningContainerEl.classList.remove('content-visible');
            meaningContainerEl.classList.add('content-hidden');
            examplesContainerEl.classList.remove('content-visible');
            examplesContainerEl.classList.add('content-hidden');
            detailsVisible = false;
            revealButton.textContent = '뜻/예문 보기';
        }

        function showDetails() {
            meaningContainerEl.classList.remove('content-hidden');
            meaningContainerEl.classList.add('content-visible');
            examplesContainerEl.classList.remove('content-hidden');
            examplesContainerEl.classList.add('content-visible');
            detailsVisible = true;
            revealButton.textContent = '숨기기';
        }
        
        revealButton.addEventListener('click', () => {
            if (isAutoPlaying) stopAutoPlay(); 
            if (detailsVisible) {
                hideDetails();
            } else {
                showDetails();
            }
        });

        prevButton.addEventListener('click', () => {
            if (isAutoPlaying) stopAutoPlay();
            currentCardIndex = (currentCardIndex - 1 + grammarData.length) % grammarData.length;
            displayCard();
        });

        nextButton.addEventListener('click', () => {
            if (isAutoPlaying) stopAutoPlay();
            currentCardIndex = (currentCardIndex + 1) % grammarData.length;
            displayCard();
        });

        toggleMemorizedButtonEl.addEventListener('click', () => {
            const card = grammarData[currentCardIndex];
            memorizedStatus[card.id] = !memorizedStatus[card.id];
            updateMemorizedButton();
            saveMemorizedStatus();
        });

        showAllButtonEl.addEventListener('click', () => {
            if (isAutoPlaying) stopAutoPlay();
            allGrammarListEl.innerHTML = ''; 
            grammarData.forEach((item, index) => {
                const listItem = document.createElement('div');
                listItem.classList.add('p-2', 'rounded-md', 'cursor-pointer', 'hover:bg-gray-100', 'flex', 'justify-between', 'items-center');
                listItem.classList.add(memorizedStatus[item.id] ? 'memorized-item' : 'not-memorized-item');
                
                const patternSpan = document.createElement('span');
                patternSpan.textContent = `${String(item.id).padStart(3, '0')}. ${item.pattern}`;
                patternSpan.classList.add('text-sm', 'sm:text-base');

                const statusSpan = document.createElement('span');
                statusSpan.textContent = memorizedStatus[item.id] ? '✅ 암기' : '❌ 암기';
                statusSpan.classList.add('text-xs', 'sm:text-sm', 'ml-2', 'font-semibold');
                if(memorizedStatus[item.id]){
                    statusSpan.classList.add('text-green-600');
                } else {
                    statusSpan.classList.add('text-red-500');
                }
                
                listItem.appendChild(patternSpan);
                listItem.appendChild(statusSpan);

                listItem.addEventListener('click', () => {
                    currentCardIndex = index;
                    displayCard();
                    modalEl.style.display = 'none';
                });
                allGrammarListEl.appendChild(listItem);
            });
            modalEl.style.display = 'block';
        });

        closeModalButtonEl.addEventListener('click', () => {
            modalEl.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if (event.target == modalEl) {
                modalEl.style.display = 'none';
            }
        });

        loadMemorizedStatus();
        if (grammarData.length > 0) {
            displayCard();
        } else {
            grammarPatternEl.textContent = "데이터가 없습니다.";
            meaningContainerEl.classList.add('content-hidden');
            examplesContainerEl.classList.add('content-hidden');
        }
    </script>

</body>
</html>